# Gary LINE Bot 蓋瑞爸爸大俠

一個功能豐富的 LINE 機器人，提供多種娛樂和實用功能。

## 🚀 功能特色

### 🎲 遊戲功能

- **比大小遊戲**: 使用 `!rollnum {人數}` 建立遊戲，`!roll` 參與遊戲
  - 支援 2-10 人同時遊戲
  - 自動記錄分數並顯示最終排名
  - 30 分鐘自動關閉未完成的遊戲

### 🔮 星座運勢

- **自動偵測星座**: 輸入星座名稱（如：牡羊、金牛、雙子等）即可獲得今日運勢
- **詳細運勢內容**: 包含愛情運、事業運、金錢運、健康運、幸運數字、顏色等
- **快取機制**: 自動快取運勢資料，提升回應速度

### 🎨 圖片功能

- **隨機美女圖**: 輸入 `抽` 獲得隨機美女圖片
- **黑絲圖片**: 輸入 `!黑絲` 獲得隨機黑絲圖片
- **白絲圖片**: 輸入 `!白絲` 獲得隨機白絲圖片
- **貓咪圖片**: 輸入 `!貓` 獲得隨機貓咪圖片
- **NSFW 內容**: 輸入 `色色` 獲得成人內容圖片

### 💬 文案功能

- **情話**: 輸入 `!情話` 獲得浪漫情話
- **騷話**: 輸入 `!騷話` 獲得撩人話語
- **幹話**: 輸入 `!幹話` 獲得搞笑文案

### 🏳️‍🌈 特殊功能

- **甲圖**: 輸入 `gay`、`!gay`、`!甲`、`甲圖` 等獲得相關圖片

### 🤖 自動回覆

機器人會自動回應以下關鍵字：

- 人名提及（如：張瑋烝、許雲藏、皓等）
- 特定用語（如：笑死、幹、勝利、花式炫等）
- 問候語（如：早安）
- 疑問句（如：？、?）

## 📋 使用指令總覽

| 指令                    | 功能           | 說明                     |
| ----------------------- | -------------- | ------------------------ |
| `!rollnum {人數}`       | 建立比大小遊戲 | 人數範圍 2-10 人         |
| `!roll`                 | 參與比大小遊戲 | 需在群組中使用           |
| `抽`                    | 隨機美女圖     | 獲得隨機美女圖片         |
| `!黑絲`                 | 黑絲圖片       | 獲得隨機黑絲圖片         |
| `!白絲`                 | 白絲圖片       | 獲得隨機白絲圖片         |
| `!貓`                   | 貓咪圖片       | 獲得隨機貓咪圖片         |
| `色色`                  | NSFW 圖片      | 獲得成人內容圖片         |
| `!情話`                 | 浪漫情話       | 獲得隨機情話文案         |
| `!騷話`                 | 撩人話語       | 獲得隨機騷話文案         |
| `!幹話`                 | 搞笑文案       | 獲得隨機搞笑文案         |
| `!gay` / `!甲` / `甲圖` | 特殊圖片       | 獲得相關圖片             |
| `{星座名稱}`            | 星座運勢       | 輸入星座名稱獲得今日運勢 |

## 🛠️ 技術架構

### 核心技術

- **Cloudflare Workers**: 無伺服器運算平台
- **Durable Objects**: 遊戲狀態管理
- **KV Storage**: 資料快取系統
- **LINE Messaging API**: 訊息處理

### 主要模組

- `src/index.ts`: 主要入口點和路由處理
- `src/handlers/messageHandler.ts`: 訊息處理邏輯
- `src/services/`: 各項功能服務
  - `horoscope.ts`: 星座運勢服務
  - `game.ts`: 遊戲功能服務
  - `copywriting.ts`: 文案服務
  - `api.ts`: LINE API 整合
- `src/durable-objects/GameStateObject.ts`: 遊戲狀態管理
- `src/config/constants.ts`: 配置常數

### 快取機制

- **運勢快取**: 25 小時過期，每日自動更新
- **文案快取**: 2 小時過期，定期更新
- **自動預載**: 定時預載資料提升回應速度

### 排程任務

- **每日 00:30 (UTC+8)**: 自動預載運勢資料
- **每兩小時**: 自動預載文案資料

## 🔧 開發指南

### 手動預載端點

- `GET /preload`: 手動觸發運勢和文案預載
- `GET /preload-copywriting`: 手動觸發文案預載

```
# wrangler.jsonc 此檔 Line Token 設置
"vars": { "LINE_CHANNEL_ACCESS_TOKEN": "" },

# 監控即時日誌
pnpm wrangler tail

# 部屬
pnpm wrangler deploy
```

## 📝 注意事項

1. **群組限制**: 遊戲功能僅限在群組中使用
2. **內容警告**: 部分功能包含成人內容，請謹慎使用
3. **快取機制**: 運勢資料每日更新，文案定期更新
4. **錯誤處理**: 系統具備完善的錯誤處理和日誌記錄
